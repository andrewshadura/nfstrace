//------------------------------------------------------------------------------
// Author: Dzianis Huznou
// Description: Unique Plugin-API interface header.
// Aggregated all definitions for plugins' development
// Copyright (c) 2013 EPAM Systems
//------------------------------------------------------------------------------
/*
    This file is part of Nfstrace.

    Nfstrace is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, version 2 of the License.

    Nfstrace is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with Nfstrace.  If not, see <http://www.gnu.org/licenses/>.
*/
//------------------------------------------------------------------------------
#define NST_PLUGIN_ENTRY_POINTS (U, C, D) \
plugin_entry_points* get_nfstrace_plugin_entry_points() \
{ \
    static const plugin_entry_points entry_points {NST_PLUGIN_API_VERSION, sizeof(plugin_entry_points), U,C,D }; \
    return &entry_points; \
}
#define NST_PUBLIC __attribute__ ((visibility("default")))
#ifndef PLUGIN_API_H
#define PLUGIN_API_H
//------------------------------------------------------------------------------
#include <iostream>

#include "fh.h"
#include "ianalyzer_type.h"
#include "nfs3_types.h"
#include "nfs4_types.h"
#include "nfs3_types_rpcgen.h"
#include "nfs4_types_rpcgen.h"
//------------------------------------------------------------------------------
using namespace NST::API;
//------------------------------------------------------------------------------
extern "C"
{
// THESE CALLS MUST BE IMPLEMENTED BY Pluggable Analysis Module
constexpr unsigned int NST_API_VERSION = @NST_V_MAJOR@ * 1000 + @NST_V_MINOR@ * 100 + @NST_V_PATCH@;
NST_PUBLIC const char* usage  ();    // return description of expected opts for create(opts)
NST_PUBLIC IAnalyzer*  create (const char*    opts); // create and return an instance of an Analyzer
NST_PUBLIC void        destroy(IAnalyzer* instance); // destroy created instance of an Analyzer

// These calls implemented by nfstrace
const char* print_nfs3_procedures(const ProcEnumNFS3::NFSProcedure proc);
const char* print_nfs4_procedures(const ProcEnumNFS4::NFSProcedure proc);
void print_session(std::ostream& out, const Session& session);
void print_nfs_fh3(std::ostream& out, const FH& fh);
}

inline std::ostream& operator<<(std::ostream& out, const Session& session)
{
    print_session(out, session);
    return out;
}

inline std::ostream& operator<<(std::ostream& out, const ProcEnumNFS3::NFSProcedure proc)
{
    return out << print_nfs3_procedures(proc);
}

inline std::ostream& operator<<(std::ostream& out, const ProcEnumNFS4::NFSProcedure proc)
{
    return out << print_nfs4_procedures(proc);
}
//------------------------------------------------------------------------------
#endif //PLUGIN_API_H
//------------------------------------------------------------------------------
